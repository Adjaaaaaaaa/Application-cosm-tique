{% extends 'base.html' %}

{% block title %}Détails du Scan - {{ scan.product_name|default:"Produit inconnu" }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
                         <nav aria-label="breadcrumb">
                 <ol class="breadcrumb">
                     <li class="breadcrumb-item"><a href="{% url 'scans:scan_list' %}">Historique des Scans</a></li>
                     <li class="breadcrumb-item active">Détails</li>
                 </ol>
             </nav>
            
            <h1 class="mb-4">
                <i class="fas fa-eye"></i> Détails du Scan
            </h1>
        </div>
    </div>

    <div class="row">
        <!-- Informations du scan -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle"></i> Informations du Scan
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-6">
                            <strong>Type de scan:</strong><br>
                            <span class="badge bg-{% if scan.scan_type == 'barcode' %}primary{% elif scan.scan_type == 'image' %}warning{% else %}secondary{% endif %}">
                                {{ scan.get_scan_type_display }}
                            </span>
                        </div>
                        <div class="col-6">
                            <strong>Date:</strong><br>
                            {{ scan.scanned_at|date:"d/m/Y H:i" }}
                        </div>
                    </div>
                    
                    {% if scan.barcode %}
                    <div class="mb-3">
                        <strong>Code-barres:</strong><br>
                        <code class="fs-5">{{ scan.barcode }}</code>
                    </div>
                    {% endif %}
                    
                    {% if scan.notes %}
                    <div class="mb-3">
                        <strong>Notes:</strong><br>
                        {{ scan.notes }}
                    </div>
                    {% endif %}
                    
                    {% if scan.image %}
                    <div class="mb-3">
                        <strong>Image:</strong><br>
                        <img src="{{ scan.image.url }}" alt="Image du scan" class="img-fluid rounded" style="max-width: 200px;">
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Informations du produit -->
        <div class="col-md-6">
            {% if scan.product_name %}
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-box"></i> Produit Scanné
                        </h5>
                    </div>
                    <div class="card-body">
                        <h4>{{ scan.product_name }}</h4>
                        <p class="text-muted">{{ scan.product_brand }}</p>
                        
                        {% if scan.product_score or scan.product_risk_level %}
                        <div class="row mb-3">
                            {% if scan.product_score %}
                            <div class="col-6">
                                <strong>Score de sécurité:</strong><br>
                                <span class="badge bg-{% if scan.product_score >= 50 %}success{% elif scan.product_score >= 25 %}warning{% else %}danger{% endif %} fs-6">
                                    {{ scan.product_score }}/100
                                </span>
                            </div>
                            {% endif %}
                            
                            {% if scan.product_risk_level %}
                            <div class="col-6">
                                <strong>Notation:</strong><br>
                                <span class="badge bg-{% if scan.product_risk_level == 'Excellent' %}success{% elif scan.product_risk_level == 'Bon' %}info{% elif scan.product_risk_level == 'Médiocre' %}warning{% elif scan.product_risk_level == 'Mauvais' %}danger{% else %}secondary{% endif %} fs-6">
                                    {{ scan.product_risk_level }}
                                </span>
                            </div>
                            {% endif %}
                        </div>
                        {% endif %}
                        
                        {% if scan.product_description %}
                        <div class="mb-3">
                            <strong>Description:</strong><br>
                            {{ scan.product_description }}
                        </div>
                        {% endif %}
                    </div>
                </div>
            {% else %}
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-exclamation-triangle"></i> Produit non trouvé
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-warning">
                            <p>Ce scan n'a pas pu être associé à un produit dans notre base de données.</p>
                            <p class="mb-0">
                                <strong>Code-barres scanné:</strong> {{ scan.barcode|default:"Non fourni" }}
                            </p>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

    {% if scan.product_name and scan.product_ingredients_text %}
        <!-- Ingrédients du produit -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-list"></i> Ingrédients
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if scan.product_ingredients_text %}
                            <div class="ingredients-list">
                                <div class="ingredients-text mt-2 p-3 bg-light rounded border">
                                    {{ scan.product_ingredients_text }}
                                </div>
                            </div>
                        {% else %}
                            <div class="no-ingredients">
                                <p class="text-muted mb-0">Aucune information d'ingrédients disponible pour ce produit.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

    <!-- Actions -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="text-center">
                        <a href="{% url 'scans:scan_list' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Retour à la liste
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
